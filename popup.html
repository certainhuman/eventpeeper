<!doctype html>
<!--suppress CssUnresolvedCustomProperty, CssUnusedSymbol -->
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Event Peeper</title>
    <style>
        :root {
            color-scheme: light dark;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            margin: 0;
            padding: 12px;
            min-width: 365px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 7px 12px;
            border-radius: 12px;
            background: color-mix(in oklab, CanvasText 6%, Canvas);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06), inset 0 0 0 1px color-mix(in oklab, CanvasText 10%, transparent);
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: saturate(1.2) blur(6px);
            gap: 12px;
        }

        h1 {
            font-size: 17px;
            margin: 0;
            letter-spacing: 0.8px;
            font-weight: 800;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 10px;
            opacity: 0.7;
            flex: 1;
        }

        .header-info-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .rate-limit-bar {
            width: 50px;
            height: 4px;
            background: color-mix(in oklab, CanvasText 15%, transparent);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .rate-limit-fill {
            height: 100%;
            background: currentColor;
            transition: width 0.2s ease;
            position: absolute;
            left: 0;
            top: 0;
        }

        .rate-limit-text {
            font-variant-numeric: tabular-nums;
        }

        .rate-limit-bar[data-level="low"] .rate-limit-fill {
            color: #2ecc71;
        }

        .rate-limit-bar[data-level="medium"] .rate-limit-fill {
            color: #f1c40f;
        }

        .rate-limit-bar[data-level="high"] .rate-limit-fill {
            color: #e74c3c;
        }

        .header-separator {
            width: 1px;
            height: 14px;
            background: color-mix(in oklab, CanvasText 20%, transparent);
        }

        .last-update {
            font-variant-numeric: tabular-nums;
        }

        /* Cards layout */
        .cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        @media (min-width: 420px) {
            .cards {
                grid-template-columns: 1fr 1fr;
            }
        }

        .card {
            border: 1px solid var(--card-border, rgba(0, 0, 0, 0.12));
            border-radius: 12px;
            padding: 10px 12px;
            background: var(--card-bg, rgba(255, 255, 255, 0.03));
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
            transition: border-color 120ms, background 120ms, transform 120ms;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: var(--bg-image, none);
            background-size: cover;
            background-position: center;
            opacity: var(--bg-opacity, 0.18);
            filter: saturate(0.9);
            pointer-events: none;
        }

        .card:hover {
        }

        .card > * {
            position: relative;
            z-index: 1;
        }

        .card-title {
            font-weight: 700;
            margin: 0 0 4px;
            font-size: 13px;
            opacity: 0.95;
        }

        .card-meta {
            margin-top: 6px;
            font-size: 11px;
            opacity: 0.75;
        }

        /* State accents */
        .card.state-open {
            border-color: #2ecc71;
        }

        .card.state-announced {
            border-color: #f1c40f;
        }

        .card.state-closed {
            border-color: #e74c3c;
        }

        .card.state-checking {
            border-color: #3498db;
            border-style: dashed;
        }

        .card.state-loading {
            border-style: dashed;
            opacity: 0.8;
        }

        .card.state-error {
            border-color: #e74c3c;
        }

        /* Header with countdown */
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .header-left {
            min-width: 0;
        }

        .event-name {
            font-size: 18px;
            font-weight: 800;
            margin: 2px 0 6px;
            letter-spacing: 0.2px;
        }

        .countdown-wrap {
            width: 80px;
            height: 80px;
            position: relative;
            flex: 0 0 auto;
        }

        .countdown-wrap svg {
            width: 80px;
            height: 80px;
            display: block;
        }

        .ring-track {
            stroke: color-mix(in oklab, currentColor 25%, transparent);
            opacity: 0.35;
        }

        .ring-progress {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.2s linear;
        }

        .countdown-text {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            font-size: 14px;
            font-weight: 700;
        }

        /* State color variables */
        .card {
            --accent: #7f8c8d;
            color: inherit;
        }

        .card.state-open {
            --accent: #2ecc71;
        }

        .card.state-announced {
            --accent: #f1c40f;
        }

        .card.state-closed {
            --accent: #e74c3c;
        }

        .card.state-checking {
            --accent: #3498db;
        }

        .card.state-error {
            --accent: #e74c3c;
        }

        .ring-progress {
            stroke: var(--accent);
        }

        .ring-track {
            stroke: currentColor;
        }

        #error {
            color: #c0392b;
            white-space: pre-wrap;
            display: none;
            margin-bottom: 8px;
        }

        #content.loading {
            opacity: 0.6;
        }

        .muted {
            opacity: 0.8;
        }

        /* Header polish */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Modern refresh button */
        /* Ensure no unexpected fills inside the SVGs (default fill is black) */
        #refreshBtn svg {
            fill: none;
        }

        #refreshBtn {
            --btn-bg: color-mix(in oklab, CanvasText 8%, Canvas);
            --btn-fg: color-mix(in oklab, CanvasText 92%, transparent);
            --btn-accent: #2ecc71;
            appearance: none;
            border: none;
            background: var(--btn-bg);
            color: var(--btn-fg);
            width: 32px;
            height: 32px;
            border-radius: 999px;
            display: inline-grid;
            place-items: center;
            font-size: 15px;
            font-weight: 700;
            line-height: 1;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.12), inset 0 0 0 1px color-mix(in oklab, CanvasText 12%, transparent);
            cursor: pointer;
            transition: transform 120ms ease, box-shadow 160ms ease, background 160ms ease, color 160ms ease;
        }

        #refreshBtn:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.16), inset 0 0 0 1px color-mix(in oklab, CanvasText 18%, transparent);
        }

        #refreshBtn:active {
            transform: translateY(2px) scale(0.98);
        }

        #refreshBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #refreshBtn:disabled:hover {
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.12), inset 0 0 0 1px color-mix(in oklab, CanvasText 12%, transparent);
            transform: none;
        }

        #refreshBtn:disabled:active {
            transform: none;
        }

        #refreshBtn .icon {
            width: 16px;
            height: 16px;
            display: block;
        }

        /* Spin animation when content is loading */
        header.loading #refreshBtn .icon {
            animation: spin 0.6s linear infinite;
        }

        /* Finish-the-lap behavior: when loading ends mid-rotation, keep spinning until the current turn completes; show check immediately */
        header.loading-done #refreshBtn .icon {
            animation: spin 0.6s linear infinite;
        }

        #refreshBtn {
            position: relative;
        }

        #refreshBtn .check {
            display: none;
            width: 12px;
            height: 12px;
            position: absolute;
            right: -2px;
            bottom: -2px;
            background: Canvas;
            border-radius: 999px;
            box-shadow: 0 0 0 2px var(--btn-bg);
        }

        header.loaded #refreshBtn .check {
            display: block;
            color: var(--btn-accent);
        }

        @keyframes spin {
            from {
                transform: rotate(0);
            }
            to {
                transform: rotate(360deg);
            }
        }

        small {
            font-size: 11px;
        }

        /* Credits row: simple small text near bottom */
        .credits {
            margin: 12px 0 4px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .credits .left {
            display: flex;
            align-items: center;
            gap: 8px;
            color: color-mix(in oklab, currentColor 70%, transparent);
        }

        .credits a {
            color: inherit;
            text-decoration: none;
            border-bottom: 1px dotted currentColor;
        }

        .credits a:hover {
            border-bottom-style: solid;
        }

        .credits .badge {
            display: none;
        }
    </style>
</head>
<body>
<header>
    <h1>Event Peeper</h1>
    <div class="header-info">
        <div class="header-info-item">
            <span class="rate-limit-text" id="rateLimitText">—</span>
            <div class="rate-limit-bar" id="rateLimitBar" data-level="low">
                <div class="rate-limit-fill" id="rateLimitFill" style="width: 0%"></div>
            </div>
        </div>
        <div class="header-separator"></div>
        <div class="header-info-item">
            <span class="last-update" id="lastUpdate">—</span>
        </div>
        <div class="header-separator"></div>
        <div class="header-info-item">
            <span id="activeEvents">—</span>
        </div>
    </div>
    <div class="header-actions">
        <button id="refreshBtn" title="Refresh now" aria-label="Refresh">
            <svg class="icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polyline points="23 4 23 10 17 10"/>
                <polyline points="1 20 1 14 7 14"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/>
                <path d="M20.49 15a9 9 0 0 1-14.85 3.36L1 14"/>
            </svg>
            <svg class="check" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="3"
                 stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polyline points="20 6 9 17 4 12"/>
            </svg>
        </button>
    </div>
</header>

<div id="error"></div>

<div id="content" class="loading">
    <div id="rows" class="cards"></div>
    <div class="credits">
        <div class="left">
            <small class="muted">Data from event-api.certainhuman.com</small>
        </div>
        <div class="right">
            <small>by <a href="https://github.com/certainhuman/" target="_blank"
                         rel="noopener noreferrer">HaveFun</a></small>
        </div>
    </div>
</div>

<script src="popup.js" type="module"></script>
</body>
</html>